<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DCVTC66 ‚Äî Chauffeur VTC √† Perpignan</title>
  <meta name="description" content="DCVTC66, chauffeur VTC √† Perpignan, propose des trajets fiables, confortables et ponctuels dans tout le d√©partement 66 et au-del√†. R√©servation simple et rapide." />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="LOGO DCVTC66.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2563eb">
  <link rel="apple-touch-icon" href="/icon-192.png">

  <style>
    html, body { margin: 0; padding: 0; overflow-x: hidden; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; box-sizing: border-box; }

    .nav-inner ul { display: flex; gap: 1rem; list-style: none; padding-left: 0; margin: 0; }
    .nav-inner ul li a { text-decoration: none; }

    .hero-actions { display: flex; gap: 0.55rem; margin-top: 1.05rem; justify-content: center; flex-wrap: wrap; }
    .hero-actions a.btn-primary { display: inline-flex; align-items: center; justify-content: center; padding: 0.45rem 0.9rem; font-size: 0.8rem; border-radius: 999px; text-align: center; white-space: nowrap; }

    /* Carte flottante d'estimation */
    #tarif-flottant {
      position: fixed; top: 24px; right: 24px; z-index: 9999; display: none; align-items: center; gap: 0.75rem;
      padding: 0.9rem 1.3rem; border-radius: 999px; background: linear-gradient(135deg, #16a34a, #22c55e);
      color: #022c22; box-shadow: 0 16px 40px rgba(22, 163, 74, 0.7); font-size: 0.95rem; font-weight: 600; max-width: 90vw;
      border: 1px solid rgba(6, 95, 70, 0.75); animation: pulseTarif 1.6s ease-in-out infinite;
    }
    #tarif-flottant .icon { font-size: 1.3rem; }
    @keyframes pulseTarif {
      0% { transform: scale(1); box-shadow: 0 12px 30px rgba(22, 163, 74, 0.55); }
      50% { transform: scale(1.06); box-shadow: 0 18px 45px rgba(22, 163, 74, 0.85); }
      100% { transform: scale(1); box-shadow: 0 12px 30px rgba(22, 163, 74, 0.55); }
    }

    .section-intro { margin-bottom: 0.75rem; }
    .form-compact { max-width: 560px; margin: 0 auto; }
    .form-compact .row { display: grid; grid-template-columns: 1fr 1fr; gap: .6rem; }
    .form-compact label { display: flex; flex-direction: column; gap: .25rem; font-size: .85rem; font-weight: 500; letter-spacing: .02em; }
    .form-compact input, .form-compact textarea { padding: .75rem .85rem; border-radius: 14px; font-size: .92rem; line-height: 1.4; }
    .form-compact textarea { resize: vertical; min-height: 72px; }

    details.opt { margin-top: .45rem; }
    details.opt summary { cursor: pointer; font-weight: 700; opacity: .9; margin: .35rem 0 .25rem; }

    .actions-compact{
      display:grid;
      grid-template-columns: 1fr 1.15fr;
      gap:.6rem;
      margin-top:.75rem;
    }
    .actions-compact .btn-primary,
    .actions-compact .btn-estimate{
      border-radius:999px;
      padding:.9rem 1rem;
      font-weight:800;
      letter-spacing:.02em;
    }

    /* Bouton Email pleine largeur */
    .email-action{
      margin-top: .6rem;
      width: 100%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      border-radius: 999px;
      padding: .9rem 1rem;
      font-weight: 800;
      letter-spacing: .02em;
    }

    .result-compact, .error-compact{ margin-top:.6rem; padding:.65rem .75rem; border-radius:12px; font-size:.85rem; line-height:1.35; }
    .result-compact{ background:#f0f7ff; color:#1b3b68; }
    .error-compact{ background:#ffecec; color:#a40000; }

    /* Carte TOUJOURS visible */
    .map-wrapper { margin-top: .7rem; border-radius: 16px; overflow: hidden; }
    .map-wrapper-inner { position:relative; width:100%; height:320px; }
    #map { width:100%; height:100%; }

    /* IMPORTANT : on supprime le carr√© blanc => plus de #tarif-overlay */

    @media (max-width: 768px) {
      .nav-inner ul { justify-content: center; flex-wrap: wrap; text-align: center; }
      .header-inner, .branding { text-align: center; }
      .branding { max-width: 520px; margin: 0 auto; }
      .logo { margin: 0 auto; display: block; }
      .site-title { margin-bottom: 0.25rem; }
      .site-subtitle { margin-top: 0; }
      .hero-badges { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.4rem; }
      .section, .section-alt { padding-left: 1.1rem; padding-right: 1.1rem; box-sizing: border-box; }
    }
    @media (max-width: 520px){
      .form-compact .row{ grid-template-columns: 1fr; }
      #tarif-flottant { left: 16px; right: 16px; top: 70px; justify-content: center; }
    }
  </style>
</head>

<body>
  <nav class="nav">
    <div class="container nav-inner">
      <ul>
        <li><a href="#reservation">R√©servation</a></li>
        <li><a href="#services">Services</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </div>
  </nav>

  <header class="header">
    <div class="container header-inner">
      <div class="branding">
        <img src="LOGO DCVTC66.png" alt="Logo DCVTC66" class="logo">
        <h1 class="site-title">DCVTC66</h1>
        <p class="site-subtitle">Chauffeur VTC priv√© √† Perpignan et dans tout le 66</p>

        <div class="hero-actions">
          <a href="tel:0663463716" class="btn-primary">üìû Appeler</a>
          <a href="https://wa.me/33663463716" target="_blank" class="btn-primary">üí¨ WhatsApp</a>
          <a href="#reservation" class="btn-primary">üìù R√©server</a>
        </div>

        <button id="btn-install" class="btn-primary" style="display:none; margin-top:10px;">
          üì≤ Installer l‚Äôapplication
        </button>

        <div class="hero-badges">
          <span>‚úî 7j/7</span>
          <span>‚úî Ponctuel</span>
          <span>‚úî Confort</span>
        </div>
      </div>
    </div>
  </header>

  <section id="reservation" class="section section-alt">
    <div class="container">
      <h2 class="section-title">R√©servation</h2>
      <p class="section-intro">R√©ponse rapide. Estimation en 1 clic.</p>

      <form id="reservation-form" class="form form-compact">
        <div class="row">
          <label>Nom
            <input type="text" name="Nom" placeholder="Nom & pr√©nom" required>
          </label>

          <label>T√©l√©phone
            <input type="tel" name="T√©l√©phone" placeholder="06‚Ä¶" required>
          </label>
        </div>

        <label>D√©part
          <input type="text" name="D√©part" placeholder="Adresse de prise en charge" required>
        </label>

        <label>Arriv√©e
          <input type="text" name="Arrivee" placeholder="Adresse de destination" required>
        </label>

        <label>Date & heure
          <input type="datetime-local" name="DateHeure" required>
        </label>

        <details class="opt">
          <summary>+ Options</summary>
          <label>Informations
            <textarea name="Message" rows="2" placeholder="Bagages, si√®ge enfant, n¬∞ de vol‚Ä¶"></textarea>
          </label>
        </details>

        <div class="actions-compact">
          <button type="button" id="btn-tarif" class="btn-estimate">Estimer</button>
          <button type="submit" class="btn-primary">Envoyer</button>
        </div>

        <!-- ‚úÖ NOUVEAU : bouton email -->
        <button type="button" id="btn-email" class="btn-primary email-action">üìß Envoyer par email</button>

        <div id="erreur-tarif" class="error-compact" style="display:none;"></div>
        <div id="resultat-tarif" class="result-compact" style="display:none;"></div>

        <div class="map-wrapper" id="map-wrapper">
          <div class="map-wrapper-inner">
            <div id="map"></div>
            <!-- ‚ùå supprim√© : <div id="tarif-overlay"></div> -->
          </div>
        </div>
      </form>
    </div>
  </section>

  <section id="services" class="section">
    <div class="container">
      <h2 class="section-title">Nos services</h2>
      <p class="section-intro">Transferts, gares, a√©roports, d√©placements pro et mise √† disposition.</p>

      <div class="grid">
        <article class="card">
          <h3>A√©roports</h3>
          <p>Perpignan, Toulouse, Montpellier, Barcelone‚Ä¶</p>
        </article>

        <article class="card">
          <h3>Gares</h3>
          <p>Perpignan, Narbonne et alentours.</p>
        </article>

        <article class="card">
          <h3>Professionnel</h3>
          <p>RDV, s√©minaires, d√©placements business.</p>
        </article>

        <article class="card">
          <h3>Mise √† disposition</h3>
          <p>√âv√©nements, mariages, soir√©es, journ√©e.</p>
        </article>
      </div>
    </div>
  </section>

  <section id="contact" class="section">
    <div class="container">
      <h2 class="section-title">Contact</h2>

      <div class="contact-grid">
        <div>
          <p>üìû <a href="tel:+33663463716"><strong>+33 6 63 46 37 16</strong></a></p>
          <p>üí¨ <a href="https://wa.me/33663463716" target="_blank"><strong>WhatsApp</strong></a></p>
        </div>
        <div>
          <p>üìß <strong>driveconfort66@gmail.com</strong></p>
          <p>üìç Perpignan ‚Äî d√©placements 66 & au-del√†</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container footer-legal">
      <p>¬© <span id="year"></span> DCVTC66 ‚Äî Tous droits r√©serv√©s</p>
      <p class="footer-links">
        <a href="mentions-legales.html">Mentions l√©gales</a> ¬∑
        <a href="politique-confidentialite.html">Politique de confidentialit√©</a> ¬∑
        <a href="plan-du-site.html">Plan du site</a>
      </p>
    </div>
  </footer>

  <a href="tel:+33663463716" class="fab fab-call" aria-label="Appeler DCVTC66">üìû</a>
  <a href="https://wa.me/33663463716" target="_blank" class="fab fab-whatsapp" aria-label="WhatsApp DCVTC66">üí¨</a>

  <div id="tarif-flottant">
    <span class="icon">üí∞</span>
    <span id="tarif-flottant-texte">Estimation en cours‚Ä¶</span>
  </div>

  <div id="splash-screen" aria-label="Chargement">
    <img src="icon-192.png" alt="DCVTC66">
    <p>Connexion √† votre chauffeur priv√©‚Ä¶</p>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    function formatDateHeureFR(value) { if (!value) return ""; return value.replace("T", " √† "); }

    let derniereEstimation = null;

    const form = document.getElementById('reservation-form');
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const nom = form.Nom.value;
      const tel = form["T√©l√©phone"].value;
      const depart = form["D√©part"].value;
      const arrivee = form["Arrivee"].value;
      const dateHeure = formatDateHeureFR(form["DateHeure"].value);
      const messageClient = form["Message"].value;

      let sms = "Nouvelle demande ‚Äì DCVTC66 :\n\n";
      sms += "Nom : " + nom + "\n";
      sms += "T√©l√©phone : " + tel + "\n";
      sms += "D√©part : " + depart + "\n";
      sms += "Arriv√©e : " + arrivee + "\n";
      sms += "Date & heure : " + dateHeure + "\n";
      if (messageClient.trim() !== "") sms += "Infos : " + messageClient + "\n";

      if (derniereEstimation) {
        sms += "\n--- Estimation ---\n";
        sms += "Distance : " + derniereEstimation.distanceKm + " km\n";
        sms += "Dur√©e : " + derniereEstimation.dureeTexte + "\n";
        sms += "Tarif : " + derniereEstimation.tarif.toFixed(2) + " ‚Ç¨\n";
      }

      const numero = "+33663463716";
      window.location.href = "sms:" + numero + "?&body=" + encodeURIComponent(sms);
    });
  </script>

  <script>
    const BASE_KM = 7;
    const BASE_TARIF = 20;
    const SUPP_PAR_KM = 1.60;

    let map;
    let distanceService;
    let directionsService;
    let directionsRenderer;

    function initMap() {
      const mapElement = document.getElementById("map");
      if (!mapElement) return;

      map = new google.maps.Map(mapElement, {
        center: { lat: 42.6986, lng: 2.8956 },
        zoom: 11,
      });

      distanceService = new google.maps.DistanceMatrixService();
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        map: map,
        suppressMarkers: false,
        suppressInfoWindows: true
      });

      const inputDepart = document.querySelector('input[name="D√©part"]');
      const inputArrivee = document.querySelector('input[name="Arrivee"]');

      if (inputDepart) {
        new google.maps.places.Autocomplete(inputDepart, {
          types: ['geocode'],
          componentRestrictions: { country: 'fr' }
        });
      }

      if (inputArrivee) {
        new google.maps.places.Autocomplete(inputArrivee, {
          types: ['geocode'],
          componentRestrictions: { country: 'fr' }
        });
      }

      const btnTarif = document.getElementById("btn-tarif");
      if (btnTarif) btnTarif.addEventListener("click", calculerTarif);
    }

    function calculerTarif() {
      const resDiv = document.getElementById("resultat-tarif");
      const errDiv = document.getElementById("erreur-tarif");
      const flottant = document.getElementById("tarif-flottant");
      const flottantTexte = document.getElementById("tarif-flottant-texte");

      const depart = form["D√©part"].value.trim();
      const arrivee = form["Arrivee"].value.trim();

      errDiv.style.display = "none"; errDiv.textContent = "";
      resDiv.style.display = "none"; resDiv.textContent = "";
      if (flottant) flottant.style.display = "none";

      if (!depart || !arrivee) {
        errDiv.textContent = "Veuillez renseigner le d√©part et l‚Äôarriv√©e.";
        errDiv.style.display = "block";
        form.scrollIntoView({ behavior: "smooth", block: "start" });
        return;
      }

      resDiv.style.display = "block";
      resDiv.innerHTML = "Calcul en cours‚Ä¶";

      distanceService.getDistanceMatrix(
        {
          origins: [depart],
          destinations: [arrivee],
          travelMode: google.maps.TravelMode.DRIVING,
          unitSystem: google.maps.UnitSystem.METRIC,
        },
        (response, status) => {
          if (status !== "OK") {
            resDiv.style.display = "none";
            errDiv.textContent = "Erreur Google Maps : " + status;
            errDiv.style.display = "block";
            return;
          }

          const element = response.rows[0].elements[0];
          if (element.status !== "OK") {
            resDiv.style.display = "none";
            errDiv.textContent = "Adresse introuvable. V√©rifiez l‚Äôorthographe.";
            errDiv.style.display = "block";
            return;
          }

          const distanceMetres = element.distance.value;
          let distanceKm = Math.round((distanceMetres / 1000) * 10) / 10;
          const dureeTexte = element.duration.text;

          let tarif = BASE_TARIF;
          if (distanceKm > BASE_KM) tarif += (distanceKm - BASE_KM) * SUPP_PAR_KM;
          tarif = Math.round(tarif * 100) / 100;

          derniereEstimation = { distanceKm, dureeTexte, tarif };

          resDiv.style.display = "block";
          resDiv.innerHTML =
            "Distance : <strong>" + distanceKm + " km</strong> ‚Ä¢ " +
            "Dur√©e : <strong>" + dureeTexte + "</strong><br>" +
            "Estimation : <strong>" + tarif.toFixed(2) + " ‚Ç¨</strong>";

          if (flottant && flottantTexte) {
            flottantTexte.textContent =
              "Estimation : " + tarif.toFixed(2) + " ‚Ç¨ ‚Ä¢ " +
              distanceKm + " km ‚Ä¢ " + dureeTexte;
            flottant.style.display = "flex";
          }

          if (directionsService && directionsRenderer) {
            directionsService.route(
              { origin: depart, destination: arrivee, travelMode: google.maps.TravelMode.DRIVING },
              (result, statusDir) => { if (statusDir === "OK") directionsRenderer.setDirections(result); }
            );
          }
        }
      );
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDW4LNM6rw5DKJ3KjMP1hEvk03k5pCKg4c&callback=initMap&libraries=places" async defer></script>

  <!-- ‚úÖ Email : bouton -->
  <script>
    const btnEmail = document.getElementById("btn-email");
    if (btnEmail) {
      btnEmail.addEventListener("click", function () {
        const nom = form.Nom.value;
        const tel = form["T√©l√©phone"].value;
        const depart = form["D√©part"].value;
        const arrivee = form["Arrivee"].value;
        const dateHeure = formatDateHeureFR(form["DateHeure"].value);
        const messageClient = form["Message"].value;

        const sujet = "R√©servation ‚Äî DCVTC66";
        let body =
          "Bonjour,\n\n" +
          "Demande de r√©servation :\n\n" +
          "Nom : " + nom + "\n" +
          "T√©l√©phone : " + tel + "\n" +
          "D√©part : " + depart + "\n" +
          "Arriv√©e : " + arrivee + "\n" +
          "Date & heure : " + dateHeure + "\n";

        if (messageClient.trim() !== "") body += "\nInfos : " + messageClient + "\n";

        if (derniereEstimation) {
          body +=
            "\n--- Estimation ---\n" +
            "Distance : " + derniereEstimation.distanceKm + " km\n" +
            "Dur√©e : " + derniereEstimation.dureeTexte + "\n" +
            "Tarif : " + Number(derniereEstimation.tarif).toFixed(2) + " ‚Ç¨\n";
        }

        const email = "driveconfort66@gmail.com";

        if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          window.location.href =
            "mailto:" + email +
            "?subject=" + encodeURIComponent(sujet) +
            "&body=" + encodeURIComponent(body);
        } else {
          window.open(
            "https://mail.google.com/mail/?view=cm&fs=1" +
            "&to=" + encodeURIComponent(email) +
            "&su=" + encodeURIComponent(sujet) +
            "&body=" + encodeURIComponent(body),
            "_blank"
          );
        }
      });
    }
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js");
    }

    let deferredPrompt = null;
    const btnInstall = document.getElementById("btn-install");

    const isStandalone =
      window.matchMedia("(display-mode: standalone)").matches ||
      window.navigator.standalone === true;

    if (isStandalone && btnInstall) btnInstall.style.display = "none";

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (btnInstall) btnInstall.style.display = "inline-flex";
    });

    if (btnInstall) {
      btnInstall.addEventListener("click", async () => {
        const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
        if (isIOS) {
          alert('Sur iPhone : Safari ‚Üí Partager (‚¨ÜÔ∏è) ‚Üí "Sur l‚Äô√©cran d‚Äôaccueil".');
          return;
        }
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        btnInstall.style.display = "none";
      });
    }

    window.addEventListener("appinstalled", () => {
      if (btnInstall) btnInstall.style.display = "none";
    });

    window.addEventListener("load", () => {
      const splash = document.getElementById("splash-screen");
      if (!splash) return;
      splash.style.opacity = "0";
      setTimeout(() => splash.remove(), 600);
    });
  </script>

</body>
</html>
